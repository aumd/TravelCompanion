<html>

<head>
    <title>Room 01</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- jquery mobile -->
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css">
    <script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
	
	<script src="js/fastclick.js"></script>
	
	<!-- CRUD -->
	<script>
	
	$(function(){
	var operation = "A"; //"A"=Adding; "E"=Editing

	var selected_index = -1; //Index of the selected list item

	var tbClients = localStorage.getItem("tbClients");//Retrieve the stored data

	tbClients = JSON.parse(tbClients); //Converts string to object

	if(tbClients == null) //If there is no data, initialize an empty array
		tbClients = [];

	function Add(){
		var client = JSON.stringify({
			RoomNo   : $("#txtRoomNo").val(),
			ReserveTime   : $("#txtReserveTime").val(),
			Name  : $("#txtName").val(),
			Phone : $("#txtContact").val(),
			Email : $("#txtEmail").val()
		});
		tbClients.push(client);
		localStorage.setItem("tbClients", JSON.stringify(tbClients));
		alert("Reservation added!");
		return true;
	}
	
	function Edit(){
		tbClients[selected_index] = JSON.stringify({
				RoomNo   : $("#txtRoomNo").val(),
				ReserveTime   : $("#txtReserveTime").val(),
				Name  : $("#txtName").val(),
				Phone : $("#txtContact").val(),
				Email : $("#txtEmail").val()
			});//Alter the selected item on the table
		localStorage.setItem("tbClients", JSON.stringify(tbClients));
		alert("Reservation updated!")
		operation = "A"; //Return to default value
		return true;
	}

	function Delete(){
		if(confirm("Are you sure you want to delete reservation?")){
			tbClients.splice(selected_index, 1);
			localStorage.setItem("tbClients", JSON.stringify(tbClients));
			alert("Deleted reservation!");
		}
	}

	function List(){		
		$("#tblList").html("");
		$("#tblList").html(
			"<thead>"+
			"	<tr>"+
			"	<th></th>"+
			"	<th>Rooms</th>"+
			"	<th>ReserveTime</th>"+
			"	<th>Name</th>"+
			"	<th>Email</th>"+
			"	</tr>"+
			"</thead>"+
			"<tbody>"+
			"</tbody>"
			);
		for(var i in tbClients){
			var cli = JSON.parse(tbClients[i]);
		  	$("#tblList tbody").append("<tr>"+
									 	 "	<td><img src= 'img/edit.png' alt='Edit"+i+"' class='btnEdit'/><img src= 'img/delete.png' alt='Delete"+i+"' class='btnDelete'/></td>" + 
										 "	<td>"+cli.RoomNo+"</td>" + 
										"	<td>"+cli.ReserveTime+"</td>" + 
										 "	<td>"+cli.Name+"</td>" + 
										 "	<td>"+cli.Email+"</td>" + 
		  								 "</tr>");
		}
	}

	$("#frmCadastre").bind("submit",function(){		
		if(operation == "A")
			return Add();
		else
			return Edit();
	});

	List();

	$(".btnEdit").bind("click", function(){

		operation = "E";
		selected_index = parseInt($(this).attr("alt").replace("Edit", ""));
		
		var cli = JSON.parse(tbClients[selected_index]);
		$("#txtRoomNo").val(cli.RoomNo);
		$("#txtReserveTime").val(cli.ReserveTime);
		$("#txtName").val(cli.Name);
		$("txtContact").val(cli.Contact);
		$("#txtEmail").val(cli.Email);
		$("#txtRoomNo").attr("readonly","readonly");
		$("#txtName").focus();
	});

	$(".btnDelete").bind("click", function(){
		selected_index = parseInt($(this).attr("alt").replace("Delete", ""));
		Delete();
		List();
	});
});
	</script>
	
</head>
  <body>
		
	<div data-role="header">
		<a href="Index.html" data-role="button" data-icon="home" onclick="doSomething(); return false" rel="external">Home</a>
		<h1>Rooms</h1>
		<a href="RoomList.html" data-role="button" data-icon="back" onclick="doSomething(); return false" rel="external">Back</a>
		</div>

    <div class="container">
	<form id="frmCadastre">
	<ul data-role="listview" data-inset="true">
	
			<li><center><img src="img/rooms/01.jpg" height="200px" width="200px"></center></li>
			<li>
				<label for="txtRoomNo" class="select">Room Number</label>
				<input name="roomnumber" id="roomnumber" placeholder="" value="01" type="text" readOnly="true"/>
			</li>

			<li>
  				<label for="reservetime" class="select">ReserveTime:</label>
           			 <select name="ReserveTime" id="txtReserveTime">
                			<option value="8 Hours">8 Hours</option>
							<option value="12 Hours">12 Hours</option>
							<option value="24 Hours">24 Hours</option>
           			 </select>
			</li>

	<!-- end -->
        <li data-role="fieldcontain">
            <label for="txtName">Full Name:</label>
            <input type="text" name="fname" id="txtName" value="" maxlength="50" data-clear-btn="true"required/>
        </li>
        
        <!-- <li data-role="fieldcontain">
            <label for="address">Address:</label>
            <input type="text" name="address" id="address" value="" maxlength="75" data-clear-btn="true"required/>
        </li> -->
        
       <li data-role="fieldcontain">
     	 	<label for="txtEmail">Email: </label>
    		<input type="email" data-clear-btn="false" name="email-1" maxlength="30" id="txtEmail" value=""required/>
       </li>
       
         <li data-role="fieldcontain">
            <label for="txtContact">Contact No:</label>
            <input type="text" name="contact" id="txtContact" value="" maxlength="15" data-clear-btn="true" pattern="[0-9]*" required/>
        </li>
  

         <div class="ui-block-a"><center><input type="submit" value="Add" id="btnSave"/><a href="#pagetwo"></center></div>
     
    </ul>
</form>
	
    </div> <!-- /container -->


</body>
</html>